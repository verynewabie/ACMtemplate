## 并查集

```c++
struct DSU{
	vector<int> p;
	void init(int n){
		p.resize(n+1);
		for(int i=1;i<=n;i++) p[i]=i;
	}
	int find(int x){
		if(p[x]!=x) p[x]=find(p[x]);
		return p[x];
	}
	void merge(int a,int b){//扩展域并查集合不能传pa+n,pb+n
		a=find(a),b=find(b);
		if(a!=b) p[a]=b;
	}
	bool same(int a,int b){
		a=find(a),b=find(b);
		return a==b;
	}
	int cnt(){
		int res=0;
		for(int i=1;i<p.size();i++){
			if(p[i]==i) 
				res++;
		}
		return res;
	}
};
```



## 可撤销并查集

```c++
struct DSU{
	vector<int> p;
	vector<int> sz;
	vector<pii> his_sz;
	vector<pii> his_p;
	void init(int n){
		p.resize(n+1),sz.resize(n+1);
		for(int i=1;i<=n;i++)
			p[i]=i,sz[i]=1;
	}
	int find(int x){
		while(x!=p[x])
			x=p[x];
		return x;
	}
	bool same(int u,int v){
		return find(u)==find(v);
	}
	void merge(int u,int v){
		int x=find(u);
		int y=find(v);
		if(x==y) return;
		if(sz[x]<sz[y]) swap(x, y);
		his_sz.push_back({x,sz[x]});
		sz[x]=sz[x]+sz[y];
		his_p.push_back({y,p[y]});
		p[y]=x;
	}
	int histroy(){
		return his_p.size();
	}
	void roll(int h){
		while(his_p.size()>h){
			p[his_p.back().first]=his_p.back().second;
			his_p.pop_back();
			sz[his_sz.back().first]=his_sz.back().second;
			his_sz.pop_back();
		}
	}
	int cnt(){
		int res=0;
		for(int i=1;i<p.size();i++){
			if(p[i]==i) 
				res++;
		}
		return res;
	}
};
```

